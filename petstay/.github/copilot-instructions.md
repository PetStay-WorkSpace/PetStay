<!-- Copilot / AI agent instructions for working on PetStay -->
# PetStay — AI coding agent instructions

This project is a Java Swing application (Maven, Java 17) that mixes JPA/Hibernate and direct JDBC. Use these notes to be immediately productive and to preserve project conventions.

- **Build / run**:
  - Java version: `17` (see `pom.xml` properties).
  - Build: `mvn clean package`.
  - Typical developer run: open in an IDE (NetBeans recommended because of `.form` GUI files) and run the `view.Main` class.
  - CLI run (useful when adding a temporary exec):
    - Build dependencies and classes: `mvn clean package`
    - Copy dependencies and run (PowerShell example):
      ```powershell
      mvn dependency:copy-dependencies -DincludeScope=runtime
      $cp = "target/classes;$(Get-ChildItem -Path target/dependency -Filter *.jar | ForEach-Object { $_.FullName } -join ';')"
      java -cp $cp view.Main
      ```

- **Persistence and DB**:
  - Two persistence approaches exist in the codebase:
    - JPA / Hibernate via `DatabaseJPA` (persistence unit name: `petstay`, see `src/main/resources/META-INF/persistence.xml` in resources in the packaged tree).
    - Direct JDBC helper: `factory/Persistencia.java` (uses SQLite `jdbc:sqlite:petstay.db`).
  - Prefer reusing the existing `DatabaseJPA` pattern for new JPA work: `DatabaseJPA.getInstance().getEntityManager()`.
  - Note: both `sqlite-jdbc` and `mysql-connector-java` are declared in `pom.xml` — check `persistence.xml` to know which is active in runtime.

- **Common architectural patterns**:
  - UI layer: `src/main/java/view` — Swing forms (`.form` files) were generated by NetBeans. Avoid hand-editing generated layout code where a `.form` exists; prefer NetBeans GUI builder.
  - Controllers: `src/main/java/controller` — lightweight wrappers that create an `EntityManager` (via `DatabaseJPA`) and delegate to DAOs.
    - Controllers usually close their `EntityManager` in a `close()` method; keep that behavior when adding controllers.
  - DAOs: `src/main/java/model/dao` — DAO classes implement `IDao<T>` and directly use `EntityManager` transactions. Example: `ProprietarioDAO`.
    - Transaction pattern: start `entityManager.getTransaction().begin()`, `persist()`/`remove()`, then `commit()`; `rollback()` in catches.
  - Session: `model/Session.java` — a simple singleton storing the current `Proprietario` user. Use it to access logged-in user state.

- **Conventions & gotchas observed in code**:
  - EntityManager lifecycle: controllers create per-controller `EntityManager` instances (not a global shared `EntityManager`). Follow that pattern.
  - Mixed persistence: when adding features, prefer JPA/DAO approach to keep consistency — only use `Persistencia` (JDBC) if you intentionally need raw SQL or SQLite file access.
  - UI forms: `.form` files in `view` folder are NetBeans-specific. Edits to those should be done in NetBeans to avoid breaking generated code.
  - Logging / error handling: project uses `System.out`/`System.err` printing and basic try/catch with rollbacks in DAOs — follow style when contributing small fixes; consider proposing centralized logging in a follow-up change if requested.
  - Example bugs / checks to be mindful of (do not auto-fix without tests or user confirmation): `ProprietarioDAO.findAll()` contains a JPQL string where aliases are inconsistent (`SELECT p FROM Proprietario a ORDER BY a.nome DESC`). When modifying queries, validate JPQL alias usage and run app flows that use the query.

- **Where to look for changes** (quick map):
  - `pom.xml` — Java version and dependencies (Hibernate, JDBC drivers).
  - `src/main/resources/META-INF/persistence.xml` (packaged under `target`) — active JPA configuration and persistence-unit name `petstay`.
  - `factory/DatabaseJPA.java` — JPA EntityManagerFactory singleton.
  - `factory/Persistencia.java` — direct JDBC SQLite helper.
  - `model/dao/*` — DAOs and `IDao` interface.
  - `controller/*` — controllers used by UI.
  - `view/*` — Swing UI; many `.form` files are NetBeans-generated.

- **When you change code**:
  - If you modify UI `.form` files, prefer using NetBeans to edit and regenerate Java code.
  - If you add new persistence entities, register mappings and verify `persistence.xml` and DB schema. Use `DatabaseJPA` to obtain `EntityManager` and follow existing DAO patterns.
  - Run the UI login flow (Main -> FrLogin) to smoke-test changes related to authentication or session state.

- **Examples**
  - Get an `EntityManager` and use DAO (pattern used in `ProprietarioController`):
    ```java
    EntityManager em = DatabaseJPA.getInstance().getEntityManager();
    ProprietarioDAO dao = new ProprietarioDAO(em);
    dao.save(new Proprietario(...));
    em.close();
    ```

  - JDBC helper usage (rare):
    ```java
    Connection c = Persistencia.getConnection();
    // remember to call Persistencia.closeConnection() when done
    ```

If anything in these notes is unclear or you want the instructions tailored to a particular task (e.g., adding a new entity, fixing a query, or wiring a new screen), tell me which area and I'll iterate.
